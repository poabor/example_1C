#!/bin/bash

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ 1CV8Clst.lst
if [ ! -f "1CV8Clst.lst" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –§–∞–π–ª 1CV8Clst.lst –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏!"
    exit 1
fi

echo "üìã –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–∞–ø–∫–∏ –∏–∑ 1CV8Clst.lst (–æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ —Ä–∞–∑–º–µ—Ä—É ‚Üì):"
echo "--------------------------------------------------"

# –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ñ–∞–π–ª –∏ —Å–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ
grep -P '^\{' 1CV8Clst.lst | while read -r line; do
    # –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–º—è –ø–∞–ø–∫–∏ (–ø–µ—Ä–≤—ã–π –±–ª–æ–∫ –¥–æ –∑–∞–ø—è—Ç–æ–π)
    folder_name=$(echo "$line" | grep -oP '^\{\K[^,]+')
    
    # –ò–∑–≤–ª–µ–∫–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ (–≤—Ç–æ—Ä–æ–π –±–ª–æ–∫ –≤ –∫–∞–≤—ã—á–∫–∞—Ö)
    description=$(echo "$line" | grep -oP '^[^,]+\s*,\s*"\K[^"]+')
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏
    if [ -d "$folder_name" ]; then
        # –ü–æ–ª—É—á–∞–µ–º —Ä–∞–∑–º–µ—Ä –ø–∞–ø–∫–∏ –≤ —É–¥–æ–±–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
        size=$(du -sh "$folder_name" 2>/dev/null | cut -f1)
        [ -z "$size" ] && size="0"  # –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞
        
        # –í—ã–≤–æ–¥–∏–º –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
        echo "$size $folder_name \"$description\""
    fi
done | sort -hr | while read -r size folder desc; do
    # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤—ã–≤–æ–¥
    printf "%-40s %-10s %s\n" "$folder" "($size)" "$desc"
done

echo "--------------------------------------------------"
exit 0